<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelApp Onboarding</title>
    <style>
        /* Estilo para ocultar la barra de desplazamiento */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Carrusel */
        #carousel {
            overflow: hidden;
            position: relative;
            touch-action: pan-y;
            user-select: none;
        }
        .carousel-track {
            display: flex;
            height: 100%;
            transform: translate3d(0, 0, 0);
            will-change: transform;
        }
        .carousel-track > section {
            flex: 0 0 100%;
            height: 100%;
        }

        /* Transiciones suaves para los puntos y el botón */
        .transition-all-custom {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #d1d5db; /* gray-300 */
            transition: all 0.3s ease;
        }

        .dot.active {
            background-color: #2563eb; /* blue-600 */
            width: 24px;
            border-radius: 5px;
        }

        /* Layout base para ocupar toda la pantalla */
        html, body {
            background-color: #f3f4f6;
            height: 100%;
            margin: 0;
           /* font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; */
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        .app-container {
            width: 100%;
            height: 100%;
            background: white;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .carousel-stage {
            flex: 1 1 auto;
        }

        .screen {
            min-width: 100%;
            height: 100%;
            position: relative;
            --top-row-height: 140px;
            --middle-row-height: 340px;
            --bottom-row-height: 40px;
            --top-row-offset: 5px;
            --bottom-row-offset: 10px;
            --middle-row-offset: 40px;
            --top-row-padding: 20px;
            --bottom-row-padding: 20px;
            padding: 0px;
            box-sizing: border-box;
        }

        .screen-row {
            display: flex;
            justify-content: center;
            position: absolute;
            left: 0;
            width: 100%;
        }

        .screen-row-top {
            align-items: center;
            text-align: center;
            top: var(--top-row-offset);
            height: var(--top-row-height);
            padding: var(--top-row-padding);
            box-sizing: border-box;
        }

        .screen-row-middle {
            align-items: center;
            width: 100%;
            height: var(--middle-row-height);
            top: calc(50% + var(--middle-row-offset));
            transform: translateY(-50%);
        }

        .screen-row-bottom {
            align-items: flex-start;
            text-align: center;
            padding-top: 16px;
            bottom: var(--bottom-row-offset);
            height: var(--bottom-row-height);
            padding: var(--bottom-row-padding);
            box-sizing: border-box;
        }

        .screen-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        .nav-area {
            height: 96px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 32px;
            position: relative;
            box-sizing: border-box;
        }

        .pagination-dots {
            position: absolute;
            left: 50%;
            display: flex;
            gap: 16px;
            align-items: center;
            transform: translateX(-50%);
            bottom: 42px;
        }

        .btn-continue {
            position: absolute;
            left: 50%;
            bottom: 24px;
            width: 100%;
            max-width: 20rem;
            background-color: #2563eb;
            color: #ffffff;
            font-weight: 700;
            font-size: 1.125rem;
            padding: 16px 0;
            border: none;
            border-radius: 999px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.12), 0 4px 6px -4px rgba(0, 0, 0, 0.12);
            transform: translateX(-50%) scale(0.95);
            opacity: 0;
            pointer-events: none;
        }

        .is-hidden {
            display: none;
        }

        .is-visible {
            opacity: 1;
            transform: translateX(-50%) scale(1);
            pointer-events: auto;
        }

        .is-faded {
            opacity: 0;
        }

        .is-disabled {
            pointer-events: none;
        }

        .main-message {
            font-size: 1.875rem;
            font-weight: 800;
            color: #1f2937;
            line-height: 1.375;
            letter-spacing: -0.07em;
            text-transform: uppercase;
        }

        .sub-message {
            font-size: 1.125rem;
            font-weight: 400;
            color: #6b7280;
            line-height: 1.5;
        }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- Carrusel de mensajes -->
        <div id="carousel" class="carousel-stage">
            <div id="carouselTrack" class="carousel-track">

            <!-- Pantalla 1 -->
            <section class="screen">
                <div class="screen-row screen-row-top main-message" data-main-index="0"></div>
                <div class="screen-row screen-row-middle">
                    <img src="1.png" alt="Equipaje ordenado" class="screen-image" />
                </div>
                <div class="screen-row screen-row-bottom sub-message" data-sub-index="0"></div>
            </section>

            <!-- Pantalla 2 -->
            <section class="screen">
                <div class="screen-row screen-row-top main-message" data-main-index="1"></div>
                <div class="screen-row screen-row-middle">
                    <img src="2.png" alt="Familia y bolsos" class="screen-image" />
                </div>
                <div class="screen-row screen-row-bottom sub-message" data-sub-index="1"></div>
            </section>

            <!-- Pantalla 3 -->
            <section class="screen">
                <div class="screen-row screen-row-top main-message" data-main-index="2"></div>
                <div class="screen-row screen-row-middle">
                    <img src="3.png" alt="Recorrido en casa" class="screen-image" />
                </div>
                <div class="screen-row screen-row-bottom sub-message" data-sub-index="2"></div>
            </section>
            </div>
        </div>

        <!-- Área de navegación inferior -->
        <div class="nav-area">
            
            <!-- Puntos dinámicos -->
            <div id="pagination-dots" class="pagination-dots transition-all-custom">
                <div class="dot active"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>

            <!-- Botón Continuar (oculto por defecto) -->
            <button id="btn-continue" class="btn-continue transition-all-custom is-hidden">
                Continuar
            </button>
        </div>
    </div>

    <script>
        const carousel = document.getElementById('carousel');
        const track = document.getElementById('carouselTrack');
        const dots = document.querySelectorAll('.dot');
        const paginationDots = document.getElementById('pagination-dots');
        const btnContinue = document.getElementById('btn-continue');
        const totalSteps = dots.length;
        const mainMessageEls = document.querySelectorAll('[data-main-index]');
        const subMessageEls = document.querySelectorAll('[data-sub-index]');

        let currentIndex = 0;
        let currentOffset = 0;
        let isAutoSnapping = false;
        let isDragging = false;
        let startX = 0;
        let startOffset = 0;
        let gestureStartIndex = 0;
        let activePointerId = null;
        let lastMoveX = 0;
        let lastMoveTime = 0;
        let dragVelocity = 0;
        let snapRafId = null;
        let buttonHideTimeout = null;
        const swipeThreshold = 50;
        const velocityThreshold = 0.35;

        function applyMessages(nodes, messages, indexKey) {
            nodes.forEach((el) => {
                const index = Number(el.dataset[indexKey]);
                if (Number.isInteger(index) && messages[index]) {
                    el.textContent = messages[index];
                }
            });
        }

        async function loadMessages() {
            try {
                const [mainRes, secondaryRes] = await Promise.all([
                    fetch('../JSON/main.json'),
                    fetch('../JSON/secondary.json')
                ]);
                const [mainData, secondaryData] = await Promise.all([
                    mainRes.json(),
                    secondaryRes.json()
                ]);

                if (Array.isArray(mainData.messages)) {
                    applyMessages(mainMessageEls, mainData.messages, 'mainIndex');
                }
                if (Array.isArray(secondaryData.messages)) {
                    applyMessages(subMessageEls, secondaryData.messages, 'subIndex');
                }
            } catch (error) {
                console.warn('No se pudieron cargar los mensajes JSON.', error);
            }
        }

        function updateUI(index) {
            dots.forEach((dot, i) => {
                if (i === index) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });

            if (buttonHideTimeout) {
                clearTimeout(buttonHideTimeout);
                buttonHideTimeout = null;
            }

            if (index === totalSteps - 1) {
                paginationDots.classList.add('is-faded', 'is-disabled');
                btnContinue.classList.remove('is-hidden');
                requestAnimationFrame(() => {
                    btnContinue.classList.add('is-visible');
                });
            } else {
                paginationDots.classList.remove('is-faded', 'is-disabled');
                btnContinue.classList.remove('is-visible');
                buttonHideTimeout = setTimeout(() => {
                    if (currentIndex !== totalSteps - 1) {
                        btnContinue.classList.add('is-hidden');
                    }
                    buttonHideTimeout = null;
                }, 400);
            }
        }

        function clampIndex(index) {
            return Math.max(0, Math.min(totalSteps - 1, index));
        }

        function offsetForIndex(index) {
            return -index * carousel.offsetWidth;
        }

        function setOffset(offset) {
            currentOffset = offset;
            track.style.transform = `translate3d(${offset}px, 0, 0)`;
        }

        function stopSnap() {
            if (snapRafId) {
                cancelAnimationFrame(snapRafId);
                snapRafId = null;
            }
            isAutoSnapping = false;
        }

        function animateToOffset(targetOffset, duration) {
            stopSnap();
            isAutoSnapping = true;

            const startOffsetAnim = currentOffset;
            const distance = targetOffset - startOffsetAnim;

            if (Math.abs(distance) < 1 || duration <= 0) {
                setOffset(targetOffset);
                isAutoSnapping = false;
                return;
            }

            const startTime = performance.now();
            const easeOutCubic = (t) => 1 - Math.pow(1 - t, 3);

            const step = (now) => {
                const t = Math.min(1, (now - startTime) / duration);
                const eased = easeOutCubic(t);
                setOffset(startOffsetAnim + distance * eased);
                if (t < 1) {
                    snapRafId = requestAnimationFrame(step);
                } else {
                    snapRafId = null;
                    isAutoSnapping = false;
                }
            };

            snapRafId = requestAnimationFrame(step);
        }

        function goToIndex(nextIndex, velocity) {
            const target = clampIndex(nextIndex);
            currentIndex = target;
            updateUI(currentIndex);

            const targetOffset = offsetForIndex(currentIndex);
            const distance = Math.abs(targetOffset - currentOffset);
            const speed = Math.max(Math.abs(velocity || 0), 0.35);
            let duration = distance / speed;
            duration = Math.min(520, Math.max(140, duration));

            animateToOffset(targetOffset, duration);
        }

        function startDrag(clientX) {
            stopSnap();
            isDragging = true;
            startX = clientX;
            startOffset = currentOffset;
            gestureStartIndex = currentIndex;
            lastMoveX = clientX;
            lastMoveTime = performance.now();
            dragVelocity = 0;
        }

        function moveDrag(clientX) {
            if (!isDragging) return;
            const deltaX = clientX - startX;
            const width = carousel.offsetWidth;
            const minIndex = Math.max(0, gestureStartIndex - 1);
            const maxIndex = Math.min(totalSteps - 1, gestureStartIndex + 1);
            const minOffset = -maxIndex * width;
            const maxOffset = -minIndex * width;
            const nextOffset = Math.max(minOffset, Math.min(maxOffset, startOffset + deltaX));
            setOffset(nextOffset);

            const now = performance.now();
            const dt = now - lastMoveTime;
            if (dt > 0) {
                const instantVelocity = (clientX - lastMoveX) / dt;
                dragVelocity = (dragVelocity * 0.7) + (instantVelocity * 0.3);
                lastMoveX = clientX;
                lastMoveTime = now;
            }
        }

        function endDrag(clientX) {
            if (!isDragging) return;
            const deltaX = clientX - startX;
            isDragging = false;

            const width = carousel.offsetWidth;
            let targetIndex = Math.round(-currentOffset / width);
            const velocity = dragVelocity;

            if (Math.abs(deltaX) >= swipeThreshold || Math.abs(velocity) >= velocityThreshold) {
                const direction = velocity !== 0 ? (velocity < 0 ? 1 : -1) : (deltaX < 0 ? 1 : -1);
                targetIndex = gestureStartIndex + direction;
            }

            const minIndex = Math.max(0, gestureStartIndex - 1);
            const maxIndex = Math.min(totalSteps - 1, gestureStartIndex + 1);
            if (targetIndex < minIndex) targetIndex = minIndex;
            if (targetIndex > maxIndex) targetIndex = maxIndex;

            goToIndex(targetIndex, velocity);
        }

        carousel.addEventListener('wheel', (event) => {
            event.preventDefault();
            if (isAutoSnapping || isDragging) return;
            const direction = event.deltaY > 0 || event.deltaX > 0 ? 1 : -1;
            goToIndex(currentIndex + direction, 1);
        }, { passive: false });

        const supportsPointer = 'PointerEvent' in window;

        if (supportsPointer) {
            carousel.addEventListener('pointerdown', (event) => {
                if (event.pointerType === 'mouse' && event.button !== 0) return;
                activePointerId = event.pointerId;
                carousel.setPointerCapture(activePointerId);
                startDrag(event.clientX);
            });

            carousel.addEventListener('pointermove', (event) => {
                if (!isDragging || event.pointerId !== activePointerId) return;
                moveDrag(event.clientX);
                event.preventDefault();
            });

            carousel.addEventListener('pointerup', (event) => {
                if (event.pointerId !== activePointerId) return;
                carousel.releasePointerCapture(activePointerId);
                activePointerId = null;
                endDrag(event.clientX);
            });

            carousel.addEventListener('pointercancel', (event) => {
                if (event.pointerId !== activePointerId) return;
                carousel.releasePointerCapture(activePointerId);
                activePointerId = null;
                endDrag(event.clientX);
            });
        } else {
            carousel.addEventListener('touchstart', (event) => {
                if (!event.touches || event.touches.length === 0) return;
                startDrag(event.touches[0].clientX);
            }, { passive: true });

            carousel.addEventListener('touchmove', (event) => {
                if (!isDragging) return;
                const currentX = event.touches && event.touches.length
                    ? event.touches[0].clientX
                    : startX;
                moveDrag(currentX);
                event.preventDefault();
            }, { passive: false });

            carousel.addEventListener('touchend', (event) => {
                if (!isDragging) return;
                const endX = event.changedTouches && event.changedTouches.length
                    ? event.changedTouches[0].clientX
                    : startX;
                endDrag(endX);
            }, { passive: true });
        }

        window.addEventListener('resize', () => {
            setOffset(offsetForIndex(currentIndex));
        });

        setOffset(offsetForIndex(currentIndex));
        updateUI(currentIndex);
        loadMessages();

        // Evento opcional para el botón
        btnContinue.addEventListener('click', () => {
            const box = document.createElement('div');
            box.innerText = "¡Bienvenido a la aventura!";
            box.style.position = 'absolute';
            box.style.bottom = '100px';
            box.style.left = '50%';
            box.style.transform = 'translateX(-50%)';
            box.style.backgroundColor = '#1f2937';
            box.style.color = 'white';
            box.style.padding = '10px 20px';
            box.style.borderRadius = '10px';
            box.style.zIndex = '100';
            
            document.querySelector('.app-container').appendChild(box);
            setTimeout(() => box.remove(), 2000);
        });
    </script>
</body>
</html>
